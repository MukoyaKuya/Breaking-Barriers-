<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}

    <meta charset="UTF-8">
    <meta name="color-scheme" content="only light">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="rgb(153, 0, 48)">
    <title>{% block title %}Breaking Barriers International{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/logo.png' %}">
    <link rel="shortcut icon" type="image/png" href="{% static 'images/logo.png' %}">

    <!-- SEO / OpenGraph -->
    <meta property="og:site_name" content="Breaking Barriers International">
    <meta property="og:title" content="{% block og_title %}Breaking Barriers International{% endblock %}">
    <meta property="og:description"
        content="{% block og_description %}Breaking barriers in life and ministry through the power of the Holy Spirit{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% static 'images/logo.png' %}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <link rel="canonical"
        href="{% block canonical %}{{ request.scheme }}://{{ request.get_host }}{{ request.path }}{% endblock %}">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}Breaking Barriers International{% endblock %}">
    <meta name="twitter:description"
        content="{% block twitter_description %}Breaking barriers in life and ministry through the power of the Holy Spirit{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% static 'images/logo.png' %}{% endblock %}">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Breaking Barriers International",
      "url": "https://bb-international.org",
      "logo": "https://bb-international.org{% static 'images/logo.png' %}",
      "sameAs": [
        "https://www.facebook.com/BreakingBarriersInt",
        "https://twitter.com/BreakingBarriers"
      ]
    }
    </script>

    <!-- PWA -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BBI">
    <link rel="apple-touch-icon" href="{% static 'images/icons/icon-192.png' %}">

    <!-- Tailwind CSS Config (Force Light Mode) -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Disables automatic system dark mode matching
            theme: {
                extend: {
                    colors: {
                        brand: 'rgb(153, 0, 48)',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- HTMX -->
    <script defer src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Alpine.js for interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts - Fjalla One and Kaushan Script -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&family=Kaushan+Script&display=swap"
        rel="stylesheet">

    <!-- Custom styles for brand color -->

    <style>
        :root {
            color-scheme: light only;
            forced-color-adjust: none;
        }

        /* Force light mode background and text for body */
        body {
            background-color: #f9fafb;
            /* gray-50 */
            color: #111827;
            /* gray-900 */
        }

        .brand-color {
            background-color: rgb(153, 0, 48);
        }

        .brand-text {
            color: rgb(153, 0, 48);
        }

        [x-cloak] {
            display: none !important;
        }

        .fjalla-one-regular {
            font-family: "Fjalla One", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        .kaushan-script-regular {
            font-family: "Kaushan Script", cursive;
            font-weight: 400;
            font-style: normal;
        }

        /* Generic rich text list styling for content authored in admin (CKEditor) */
        .prose ol,
        .article-content ol {
            list-style-type: decimal;
            margin-left: 1.5rem;
            padding-left: 0.5rem;
        }

        .prose ul,
        .article-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            padding-left: 0.5rem;
        }

        .prose li,
        .article-content li {
            margin-bottom: 0.25rem;
        }

        /* Mobile responsive: prevent horizontal scroll and overflow */
        html {
            overflow-x: hidden;
        }

        body {
            overflow-x: hidden;
        }

        .article-content img,
        .prose img {
            max-width: 100%;
            height: auto;
        }

        .article-content iframe,
        .prose iframe {
            max-width: 100%;
        }

        .article-content table,
        .prose table {
            display: block;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .article-content p,
        .prose p {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .brand-color {
            background-color: rgb(153, 0, 48) !important;
        }

        .brand-text,
        .text-brand-color {
            color: rgb(153, 0, 48) !important;
        }

        /* Aggressive Light Mode Enforcement */
        /* Override 'prefers-color-scheme: dark' styles */
        @media (prefers-color-scheme: dark) {

            html,
            body {
                background-color: #ffffff !important;
                color: #111827 !important;
            }

            .bg-white {
                background-color: #ffffff !important;
            }

            .bg-gray-50 {
                background-color: #f9fafb !important;
            }

            .text-gray-900 {
                color: #111827 !important;
            }

            .text-gray-800 {
                color: #1f2937 !important;
            }

            .text-gray-700 {
                color: #374151 !important;
            }

            .text-gray-600 {
                color: #4b5563 !important;
            }

            .text-white {
                color: #ffffff !important;
            }
        }

        .safe-area-padding {
            padding-left: max(0.75rem, env(safe-area-inset-left));
            padding-right: max(0.75rem, env(safe-area-inset-right));
        }
    </style>


    {% block extra_head %}{% endblock %}
    {% block extra_css %}{% endblock %}
</head>

<body class="flex flex-col min-h-screen bg-gray-50 min-w-0">
    {% include 'church/partials/header.html' %}

    <main class="flex-grow">
        {% if messages %}
        <div class="fixed top-4 right-4 z-50 w-[calc(100vw-2rem)] max-w-md space-y-3" aria-live="polite"
            aria-atomic="true">
            {% for message in messages %}
            <div x-data="{ show: true }" x-show="show" x-init="setTimeout(() => show = false, 6000)"
                x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2"
                x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 translate-y-2"
                class="
                            rounded-xl shadow-xl border p-4
                            {% if 'success' in message.tags %}
                                bg-green-600 text-white border-green-700
                            {% elif 'error' in message.tags %}
                                bg-red-600 text-white border-red-700
                            {% elif 'warning' in message.tags %}
                                bg-yellow-400 text-gray-900 border-yellow-500
                            {% else %}
                                bg-blue-600 text-white border-blue-700
                            {% endif %}
                        " role="alert">
                <div class="flex items-start gap-3">
                    <div class="mt-0.5 text-lg leading-none">
                        {% if 'success' in message.tags %}
                        <i class="fa-solid fa-circle-check"></i>
                        {% elif 'error' in message.tags %}
                        <i class="fa-solid fa-circle-xmark"></i>
                        {% elif 'warning' in message.tags %}
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        {% else %}
                        <i class="fa-solid fa-circle-info"></i>
                        {% endif %}
                    </div>

                    <div class="flex-1">
                        <p class="font-semibold leading-snug">Message</p>
                        <p class="opacity-95 leading-relaxed">{{ message }}</p>
                    </div>

                    <button type="button" class="ml-2 opacity-90 hover:opacity-100 transition"
                        aria-label="Close notification" @click="show = false">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

    {% include 'church/partials/footer.html' %}

    {% block extra_js %}{% endblock %}

    <!-- PWA Service Worker Management -->
    <script>
        // AGGRESSIVE SERVICE WORKER CACHE CLEARING
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.getRegistrations().then(function (registrations) {
                    for (let registration of registrations) {
                        console.log('Unregistering Service Worker:', registration.scope);
                        registration.unregister();
                    }
                });

                // Clear all caches
                if ('caches' in window) {
                    caches.keys().then(function (names) {
                        for (let name of names) {
                            console.log('Deleting cache:', name);
                            caches.delete(name);
                        }
                    });
                }
            });
        }
    </script>
</body>

</html>