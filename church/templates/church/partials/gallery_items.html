{% load thumbnail %}
{% for image in gallery_images %}
<div class="relative overflow-hidden rounded-lg shadow-md hover:shadow-xl transition duration-300 cursor-pointer"
    @click="openModal()" x-data="{ 
        openModal() { 
            {% if image.video_url %}
            $dispatch('open-lightbox', { 
                url: '{{ image.get_embed_url }}', 
                caption: '{{ image.caption|escapejs }}',
                isVideo: true 
            })
            {% elif image.get_image_url %}
            $dispatch('open-lightbox', { 
                url: '{{ image.get_image_url }}', 
                caption: '{{ image.caption|escapejs }}',
                isVideo: false 
            })
            {% endif %}
        } 
    }">
    {% if image.image %}
    {% if image.image_cropping %}
    {% thumbnail image.image "800x600" box=image.image_cropping crop=True detail=True as thumb %}
    <img src="{{ thumb.url }}" alt="{{ image.caption }}" loading="lazy"
        class="w-full h-64 object-cover hover:scale-110 transition duration-300">
    {% else %}
    <img src="{{ image.image.url }}" alt="{{ image.caption }}" loading="lazy"
        class="w-full h-64 object-cover hover:scale-110 transition duration-300">
    {% endif %}
    {% else %}
    <div class="w-full h-64 bg-gray-200 flex items-center justify-center">
        <i class="fas fa-image text-gray-400 text-4xl"></i>
    </div>
    {% endif %}
    <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2">
        <p class="text-sm truncate">{{ image.caption }}</p>
    </div>
</div>
{% empty %}
<div class="col-span-4 text-center text-gray-500 py-12">
    <i class="fas fa-images text-5xl mb-4 text-gray-300"></i>
    <p class="text-xl">No images available in this category.</p>
</div>
{% endfor %}
</div>