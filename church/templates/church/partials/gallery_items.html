{% load thumbnail %}

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
    {% for image in gallery_images %}
    <div class="group bg-white rounded-2xl shadow-md border border-gray-100 overflow-hidden hover:shadow-2xl transition-all duration-300 cursor-pointer flex flex-col h-full"
        @click="openModal()" x-data="{ 
            openModal() { 
                {% if image.video_url %}
                $dispatch('open-lightbox', { 
                    url: '{{ image.get_embed_url }}', 
                    caption: '{{ image.caption|escapejs }}',
                    isVideo: true 
                })
                {% elif image.image %}
                $dispatch('open-lightbox', { 
                    url: '{{ image.get_image_url }}', 
                    caption: '{{ image.caption|escapejs }}',
                    isVideo: false 
                })
                {% endif %}
            } 
        }">

        <!-- Media Container -->
        <div class="relative aspect-[4/3] overflow-hidden bg-gray-100">
            {% if image.video_url and image.get_youtube_thumbnail_url %}
            <img src="{{ image.get_youtube_thumbnail_url }}" alt="{{ image.caption }}" loading="lazy"
                class="w-full h-full object-cover group-hover:scale-110 transition duration-500"
                referrerpolicy="no-referrer">
            {% elif image.image %}
            {% if image.image_cropping %}
            {% thumbnail image.image "800x600" box=image.image_cropping crop=True detail=True as thumb %}
            <picture>
                <source srcset="{{ thumb.url }}.webp" type="image/webp">
                <img src="{{ thumb.url }}" alt="{{ image.caption }}" loading="lazy"
                    class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
            </picture>
            {% else %}
            <img src="{{ image.image.url }}" alt="{{ image.caption }}" loading="lazy"
                class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
            {% endif %}
            {% else %}
            <div class="w-full h-full flex items-center justify-center">
                <i class="fas fa-image text-gray-300 text-5xl"></i>
            </div>
            {% endif %}

            <!-- Category Badge -->
            <div class="absolute top-4 left-4">
                <span
                    class="bg-black/60 backdrop-blur-md text-white text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-md">
                    {{ image.category }}
                </span>
            </div>

            <!-- Video Overlay -->
            {% if image.video_url %}
            <div
                class="absolute inset-0 flex items-center justify-center bg-black/10 group-hover:bg-black/20 transition-colors">
                <div
                    class="w-16 h-16 rounded-full bg-brand-color/90 flex items-center justify-center text-white text-xl shadow-lg transform group-hover:scale-110 transition duration-300 pl-1">
                    <i class="fas fa-play"></i>
                </div>
            </div>
            {% if image.duration_label %}
            <div class="absolute bottom-4 right-4 bg-black/70 text-white text-[11px] px-2 py-0.5 rounded font-mono">
                {{ image.duration_label }}
            </div>
            {% endif %}
            {% else %}
            <!-- Zoom Icon for Images -->
            <div
                class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/10">
                <div
                    class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-md border border-white/30 flex items-center justify-center text-white text-lg">
                    <i class="fas fa-search-plus"></i>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Content Area -->
        <div class="p-5 flex-grow border-t border-gray-50 bg-white">
            <h3
                class="text-gray-800 font-semibold line-clamp-2 leading-snug group-hover:text-brand-color transition-colors">
                {{ image.caption }}
            </h3>
        </div>
    </div>
    {% empty %}
    <div
        class="col-span-full text-center text-gray-400 py-20 bg-gray-50 rounded-3xl border-2 border-dashed border-gray-200">
        <div class="mb-4">
            <i class="fas fa-images text-6xl opacity-20"></i>
        </div>
        <p class="text-xl font-medium">No images available in this category.</p>
        <p class="text-sm mt-2 font-normal">Please check back later for more updates.</p>
    </div>
    {% endfor %}
</div>