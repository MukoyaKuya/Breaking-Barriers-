{% load thumbnail %}
<!-- Info Cards Section -->
<section class="bg-gray-50 pt-2 pb-4">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Card 1: Children's Bread -->
            <div
                class="rounded-xl shadow-lg border-2 border-gray-400 overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 flex flex-col h-full">
                <div class="px-5 pt-5 pb-3 border-b border-gray-100">
                    <h2 class="text-2xl font-bold brand-text text-center">{% if childrens_bread_card %}{{ childrens_bread_card.title }}{% else %}Children's Bread{% endif %}</h2>
                </div>
                {% if childrens_bread_card or childrens_bread_articles %}
                <a href="{% url 'childrens_bread_list' %}" class="flex flex-col flex-grow">
                    <div class="relative w-full h-56 md:h-60 overflow-hidden group bg-gray-100 info-card-carousel"
                        id="info-carousel-childrens-bread" data-carousel>
                        {% if childrens_bread_articles %}
                        {% for article in childrens_bread_articles %}
                        <div class="info-carousel-slide absolute inset-0 w-full h-full {% if forloop.first %}opacity-100 z-10{% else %}opacity-0 z-0{% endif %}"
                            data-slide style="transition: opacity 0.5s ease;">
                            {% if article.image %}
                            <img src="{{ article.image.url }}" alt="{{ article.title }}"
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                            {% else %}
                            <div
                                class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-5xl"></i>
                            </div>
                            {% endif %}
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent">
                            </div>
                            <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
                                <h3 class="text-lg font-bold leading-tight line-clamp-2">{{ article.title|truncatewords:12 }}</h3>
                                <p class="text-sm mt-1 opacity-90 line-clamp-2">{{ article.summary|truncatewords:15 }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="info-carousel-slide absolute inset-0 w-full h-full opacity-100 z-10" data-slide>
                            {% if childrens_bread_card.image %}
                            <img src="{{ childrens_bread_card.image.url }}" alt="{{ childrens_bread_card.headline }}"
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                            {% else %}
                            <div
                                class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-5xl"></i>
                            </div>
                            {% endif %}
                            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                            <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
                                <h3 class="text-lg font-bold leading-tight">{{ childrens_bread_card.headline|truncatewords:12 }}</h3>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <span class="text-brand-text font-semibold hover:underline inline-flex items-center group">
                            View all articles
                            <i
                                class="fas fa-arrow-right ml-2 text-xs group-hover:translate-x-1 transition-transform"></i>
                        </span>
                        {% if childrens_bread_articles %}
                        <div class="flex gap-1 mt-3 justify-center" data-dots aria-hidden="true">
                            {% for article in childrens_bread_articles %}
                            <span
                                class="info-carousel-dot w-2 h-2 rounded-full bg-gray-300 {% if forloop.first %}brand-color{% endif %}"
                                data-index="{{ forloop.counter0 }}"></span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </a>
                {% else %}
                <div class="p-5 flex-grow flex items-center justify-center">
                    <p class="text-gray-400 text-sm text-center">No content available. Please configure in admin.</p>
                </div>
                {% endif %}
            </div>

            <!-- Card 2: News -->
            <div
                class="rounded-xl shadow-lg border-2 border-gray-400 overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 flex flex-col h-full">
                <div class="px-5 pt-5 pb-3 border-b border-gray-100">
                    <h2 class="text-2xl font-bold brand-text text-center">{% if news_card %}{{ news_card.title }}{% else %}News{% endif %}</h2>
                </div>
                {% if news_card or news_line_articles %}
                <a href="{% url 'news_line_list' %}" class="flex flex-col flex-grow">
                    <div class="relative w-full h-56 md:h-60 overflow-hidden group bg-gray-100 info-card-carousel"
                        id="info-carousel-news" data-carousel>
                        {% if news_line_articles %}
                        {% for article in news_line_articles %}
                        <div class="info-carousel-slide absolute inset-0 w-full h-full {% if forloop.first %}opacity-100 z-10{% else %}opacity-0 z-0{% endif %}"
                            data-slide style="transition: opacity 0.5s ease;">
                            {% if article.image %}
                            <img src="{{ article.image.url }}" alt="{{ article.title }}"
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                            {% else %}
                            <div
                                class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-5xl"></i>
                            </div>
                            {% endif %}
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent">
                            </div>
                            <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
                                <h3 class="text-lg font-bold leading-tight line-clamp-2">{{ article.title|truncatewords:12 }}</h3>
                                <p class="text-sm mt-1 opacity-90 line-clamp-2">{{ article.summary|truncatewords:15 }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="info-carousel-slide absolute inset-0 w-full h-full opacity-100 z-10" data-slide>
                            {% if news_card.image %}
                            <img src="{{ news_card.image.url }}" alt="{{ news_card.headline }}"
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                            {% else %}
                            <div
                                class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-5xl"></i>
                            </div>
                            {% endif %}
                            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                            <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
                                <h3 class="text-lg font-bold leading-tight">{{ news_card.headline|truncatewords:12 }}
                                </h3>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <span class="text-brand-text font-semibold hover:underline inline-flex items-center group">
                            View all articles
                            <i
                                class="fas fa-arrow-right ml-2 text-xs group-hover:translate-x-1 transition-transform"></i>
                        </span>
                        {% if news_line_articles %}
                        <div class="flex gap-1 mt-3 justify-center" data-dots aria-hidden="true">
                            {% for article in news_line_articles %}
                            <span
                                class="info-carousel-dot w-2 h-2 rounded-full bg-gray-300 {% if forloop.first %}brand-color{% endif %}"
                                data-index="{{ forloop.counter0 }}"></span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </a>
                {% else %}
                <div class="p-5 flex-grow flex items-center justify-center">
                    <p class="text-gray-400 text-sm text-center">No content available. Please configure in admin.</p>
                </div>
                {% endif %}
            </div>

            <!-- Card 3: Word of Truth -->
            <div
                class="rounded-xl shadow-lg border-2 border-gray-400 overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 flex flex-col h-full">
                <div class="px-5 pt-5 pb-3 border-b border-gray-100">
                    <h2 class="text-2xl font-bold brand-text text-center">{% if word_of_truth_card %}{{ word_of_truth_card.title }}{% else %}Word of Truth{% endif %}</h2>
                </div>
                {% if word_of_truth_card or word_of_truth_articles %}
                <a href="{% url 'word_of_truth_list' %}" class="flex flex-col flex-grow">
                    <div class="relative w-full h-56 md:h-60 overflow-hidden group bg-gray-100 info-card-carousel"
                        id="info-carousel-word-of-truth" data-carousel>
                        {% if word_of_truth_articles %}
                        {% for article in word_of_truth_articles %}
                        <div class="info-carousel-slide absolute inset-0 w-full h-full {% if forloop.first %}opacity-100 z-10{% else %}opacity-0 z-0{% endif %}"
                            data-slide style="transition: opacity 0.5s ease;">
                            {% if article.image %}
                            <img src="{{ article.image.url }}" alt="{{ article.title }}"
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                            {% else %}
                            <div
                                class="w-full h-full bg-gradient-to-br from-yellow-400 via-orange-500 to-red-600 flex items-center justify-center">
                                <i class="fas fa-book text-white text-5xl opacity-80"></i>
                            </div>
                            {% endif %}
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent">
                            </div>
                            <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
                                <h3 class="text-lg font-bold leading-tight line-clamp-2">{{ article.title|truncatewords:12 }}</h3>
                                <p class="text-sm mt-1 opacity-90 line-clamp-2">{{ article.summary|truncatewords:15 }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="info-carousel-slide absolute inset-0 w-full h-full opacity-100 z-10" data-slide>
                            {% if word_of_truth_card.image %}
                            <img src="{{ word_of_truth_card.image.url }}" alt="{{ word_of_truth_card.headline }}"
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                            {% else %}
                            <div
                                class="w-full h-full bg-gradient-to-br from-yellow-400 via-orange-500 to-red-600 flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fas fa-book text-white text-5xl opacity-80 mb-2"></i>
                                    <p class="text-white text-xs font-semibold opacity-90">Word of Truth</p>
                                </div>
                            </div>
                            {% endif %}
                            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                            <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
                                <h3 class="text-lg font-bold leading-tight">{{ word_of_truth_card.headline|truncatewords:12 }}</h3>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <span class="text-brand-text font-semibold hover:underline inline-flex items-center group">
                            View all articles
                            <i
                                class="fas fa-arrow-right ml-2 text-xs group-hover:translate-x-1 transition-transform"></i>
                        </span>
                        {% if word_of_truth_articles %}
                        <div class="flex gap-1 mt-3 justify-center" data-dots aria-hidden="true">
                            {% for article in word_of_truth_articles %}
                            <span
                                class="info-carousel-dot w-2 h-2 rounded-full bg-gray-300 {% if forloop.first %}brand-color{% endif %}"
                                data-index="{{ forloop.counter0 }}"></span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </a>
                {% else %}
                <div class="p-5 flex-grow flex items-center justify-center">
                    <p class="text-gray-400 text-sm text-center">No content available. Please configure in admin.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

<script>
    (function () {
        var CAROUSEL_INTERVAL_MS = 8500;

        function runCarousels() {
            document.querySelectorAll('[data-carousel]').forEach(function (carousel) {
                var slides = carousel.querySelectorAll('[data-slide]');
                var dotsContainer = carousel.closest('a').querySelector('[data-dots]');
                var dots = dotsContainer ? dotsContainer.querySelectorAll('.info-carousel-dot') : [];
                if (slides.length <= 1) return;

                var current = 0;
                function goTo(index) {
                    current = (index + slides.length) % slides.length;
                    slides.forEach(function (s, i) {
                        s.classList.toggle('opacity-100', i === current);
                        s.classList.toggle('z-10', i === current);
                        s.classList.toggle('opacity-0', i !== current);
                        s.classList.toggle('z-0', i !== current);
                    });
                    dots.forEach(function (d, i) {
                        d.classList.toggle('brand-color', i === current);
                        d.classList.toggle('bg-gray-300', i !== current);
                    });
                }
                function next() {
                    goTo(current + 1);
                }
                setInterval(next, CAROUSEL_INTERVAL_MS);

                dots.forEach(function (dot, i) {
                    dot.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        goTo(i);
                    });
                });
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runCarousels);
        } else {
            runCarousels();
        }
    })();
</script>