{% load thumbnail %}
{% load safe_thumbnail %}
<section class="py-10 sm:py-16 overflow-x-hidden">
    <div class="container mx-auto px-4 sm:px-6">
        <h2 class="text-2xl font-bold brand-text text-center mb-8 sm:mb-10">
            Our Partners
        </h2>
    </div>

    {% if partners %}
    {# Full-bleed (edge-to-edge) marquee; overflow-x-hidden on section prevents horizontal scroll #}
    <div class="relative overflow-hidden w-screen left-1/2 right-1/2 -ml-[50vw] -mr-[50vw]">
        <div class="partners-marquee">
            <div class="partners-marquee-inner">
                {# Group A #}
                <div class="partners-marquee-group">
                    {% for partner in partners %}
                    <div class="flex-shrink-0 max-w-[200px] md:max-w-[250px] flex items-center justify-center">
                        {% if partner.website_url %}
                        <a href="{{ partner.website_url }}" target="_blank" rel="noopener noreferrer"
                            class="block w-full">
                            {% if partner.use_cropping and partner.logo_cropping %}
                            {% safe_thumbnail partner.logo "300x200" box=partner.logo_cropping crop=True detail=True as
                            cropped %}
                            {% if cropped %}
                            <picture>
                                <source srcset="{{ cropped.url }}.webp" type="image/webp">
                                <img src="{{ cropped.url }}" alt="{{ partner.name }}" loading="lazy"
                                    class="h-24 md:h-32 w-auto max-w-full object-contain">
                            </picture>
                            {% else %}
                            <div
                                class="h-24 md:h-32 flex items-center justify-center text-gray-400 text-sm text-center px-2">
                                {{ partner.name }}
                            </div>
                            {% endif %}
                            {% else %}
                            <img src="{{ partner.logo.url }}" alt="{{ partner.name }}" loading="lazy"
                                class="h-24 md:h-32 w-auto max-w-full object-contain">
                            {% endif %}
                        </a>
                        {% else %}
                        {% if partner.use_cropping and partner.logo_cropping %}
                        {% safe_thumbnail partner.logo "300x200" box=partner.logo_cropping crop=True detail=True as
                        cropped %}
                        {% if cropped %}
                        <picture>
                            <source srcset="{{ cropped.url }}.webp" type="image/webp">
                            <img src="{{ cropped.url }}" alt="{{ partner.name }}" loading="lazy"
                                class="h-24 md:h-32 w-auto max-w-full object-contain">
                        </picture>
                        {% else %}
                        <div
                            class="h-24 md:h-32 flex items-center justify-center text-gray-400 text-sm text-center px-2">
                            {{ partner.name }}
                        </div>
                        {% endif %}
                        {% else %}
                        <img src="{{ partner.logo.url }}" alt="{{ partner.name }}" loading="lazy"
                            class="h-24 md:h-32 w-auto max-w-full object-contain">
                        {% endif %}
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                {# Group B (duplicate) - required for seamless looping #}
                <div class="partners-marquee-group" aria-hidden="true">
                    {% for partner in partners %}
                    <div class="flex-shrink-0 max-w-[200px] md:max-w-[250px] flex items-center justify-center">
                        {% if partner.website_url %}
                        <a href="{{ partner.website_url }}" target="_blank" rel="noopener noreferrer"
                            class="block w-full" tabindex="-1">
                            {% if partner.use_cropping and partner.logo_cropping %}
                            {% safe_thumbnail partner.logo "300x200" box=partner.logo_cropping crop=True detail=True as
                            cropped %}
                            {% if partner.logo %}
                            <img src="{{ partner.logo.url }}" alt="{{ partner.name }}"
                                class="max-w-[120px] max-h-[60px] object-contain filter grayscale opacity-60 hover:grayscale-0 hover:opacity-100 transition-all duration-300">
                            {% endif %}
                            {% else %}
                            {% if partner.logo %}
                            <img src="{{ partner.logo.url }}" alt="{{ partner.name }}"
                                class="w-full h-auto object-contain filter grayscale group-hover:grayscale-0 transition-all duration-300"
                                loading="lazy">
                            {% endif %}
                            {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Seamless infinite marquee (right -> left).
               We duplicate the group and translate exactly one group width (50% of inner). */
        .partners-marquee {
            width: 100%;
            overflow: hidden;
        }

        .partners-marquee-inner {
            display: flex;
            width: max-content;
            /* content defines width */
            will-change: transform;
            animation: partners-scroll-rtl 75s linear infinite;
        }

        .partners-marquee-group {
            display: flex;
            align-items: center;
            gap: 2.5rem;
            /* gap-10 */
            padding-right: 2.5rem;
            /* keep space between end/start */
        }

        @media (min-width: 768px) {
            .partners-marquee-group {
                gap: 4rem;
                /* md:gap-16 */
                padding-right: 4rem;
            }
        }

        @keyframes partners-scroll-rtl {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(-50%);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .partners-marquee-inner {
                animation: none;
            }
        }
    </style>
    {% endif %}
</section>