{% extends 'church/base.html' %}
{% load static %}
{% load thumbnail %}
{% load safe_thumbnail %}

{% block title %}{{ card.title }} - Breaking Barriers International{% endblock %}

{% block content %}
<div class="bg-white py-8">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Main Content column -->
            <div class="lg:col-span-3 space-y-10">
                <a href="{% url 'home' %}" class="text-brand-color hover:underline mb-4 inline-block">&larr; Back to
                    Home</a>

                <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                    {% if card.image %}
                    <div class="w-full aspect-[16/9] relative bg-gray-100">
                        {% if card.image_cropping %}
                        {% safe_thumbnail card.image "1600x900" box=card.image_cropping crop=True detail=True as cropped %}
                        {% if cropped %}
                        <picture>
                            <source srcset="{{ cropped.url }}.webp" type="image/webp">
                            <img src="{{ cropped.url }}" alt="{{ card.title }}" loading="lazy"
                                class="w-full h-full object-contain">
                        </picture>
                        {% else %}
                        <div class="w-full h-full brand-color opacity-90 flex items-center justify-center">
                            <i class="fas fa-info-circle text-white/30 text-6xl"></i>
                        </div>
                        {% endif %}
                        {% else %}
                        {% safe_thumbnail card.image "1600x900" crop=True detail=True as thumb %}
                        {% if thumb %}
                        <img src="{{ thumb.url }}" alt="{{ card.title }}" loading="lazy"
                            class="w-full h-full object-cover">
                        {% else %}
                        <div class="w-full h-full brand-color opacity-90 flex items-center justify-center">
                            <i class="fas fa-info-circle text-white/30 text-6xl"></i>
                        </div>
                        {% endif %}
                        {% endif %}
                        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
                        <div class="absolute bottom-6 left-8 right-8">
                            <span
                                class="bg-brand-color text-white px-3 py-1 rounded-full text-sm font-semibold shadow-lg mb-3 inline-block">
                                {{ card.get_card_type_display }}
                            </span>
                            <h1 class="text-3xl md:text-5xl font-bold text-white shadow-sm">{{ card.headline }}</h1>
                        </div>
                    </div>
                    {% else %}
                    <div class="brand-color text-white p-8 md:p-12">
                        <span
                            class="bg-white text-brand-color px-3 py-1 rounded-full text-sm font-semibold shadow-md mb-4 inline-block">
                            {{ card.get_card_type_display }}
                        </span>
                        <h1 class="text-3xl md:text-5xl font-bold">{{ card.headline }}</h1>
                    </div>
                    {% endif %}

                    <div class="p-8 md:p-12">
                        <div class="flex items-center justify-between mb-8 pb-6 border-b border-gray-100">
                            <div class="flex items-center gap-4">
                                <div
                                    class="h-12 w-12 rounded-full brand-color flex items-center justify-center text-white">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <p class="text-xs uppercase text-gray-500 font-bold tracking-wider">Posted by</p>
                                    <p class="font-semibold text-gray-900">{{ card.author_name }}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-xs uppercase text-gray-500 font-bold tracking-wider">Published</p>
                                <p class="font-semibold text-gray-900">{{ card.created_at|date:"F j, Y" }}</p>
                            </div>
                        </div>

                        <div class="prose prose-lg max-w-none text-gray-700">
                            {% if card.content %}
                            {{ card.content|safe }}
                            {% else %}
                            <p class="lead text-xl text-gray-600 mb-6 italic">{{ card.summary }}</p>
                            <p>Detailed content for this section is coming soon. Please check back later for updates.
                            </p>
                            {% endif %}
                        </div>

                        <div class="mt-12 pt-8 border-t border-gray-100 flex justify-between items-center">
                            <div class="flex gap-4">
                                <button onclick="window.print()"
                                    class="text-gray-500 hover:text-brand-color transition flex items-center gap-2">
                                    <i class="fas fa-print"></i>
                                    <span>Print Article</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right sidebar column -->
            <aside class="lg:col-span-1 space-y-8 mt-12">
                {% include 'church/partials/sidebar.html' %}
            </aside>
        </div>
    </div>
</div>
{% endblock %}